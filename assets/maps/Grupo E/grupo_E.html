<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Phaser 3 Map Example</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.87.0/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
        }
    </style>
</head>
<body>
<script>
// Classe principal do jogo
class GravityArrow extends Phaser.Scene {

    // Carregar os assets
    preload() {
        console.log('Carregando assets...');

        // Carregar o tileset (imagem usada pelo mapa)
        this.load.image('tiles', './Mapa.png');

        // Carregar o mapa (JSON exportado pelo Tiled)
        this.load.tilemapTiledJSON('map', './mapa.json');
    }

    // Criar a cena
    create() {
        console.log('Criando cena...');

        // Criar o mapa com base no JSON carregado
        const map = this.make.tilemap({ key: 'map' });

        // Associar o tileset ao mapa
        const tileset = map.addTilesetImage('mapa', './Mapa.png'); // Substitua 'Mapa' pelo nome do tileset no Tiled

        const groundLayer = map.createLayer('ground', tileset, 0, 0); // Nome da camada no Tiled
        const wallsLayer = map.createLayer('walls', tileset, 0, 0);   // Nome da camada no Tiled


        // Configurar colisões na camada de paredes (walls)
        wallsLayer.setCollisionByProperty({ collides: true });

        // Adicionar um jogador ao mapa
        this.player = this.physics.add.sprite(100, 100, null);
        this.player.setCollideWorldBounds(true);

        // Adicionar física às paredes
        this.physics.add.collider(this.player, wallsLayer);

        // Configurar controles
        this.cursors = this.input.keyboard.createCursorKeys();
    }

    // Atualizar a cena a cada frame
    update() {
        // Movimentar o jogador
        if (this.cursors.left.isDown) {
            this.player.setVelocityX(-200);
        } else if (this.cursors.right.isDown) {
            this.player.setVelocityX(200);
        } else {
            this.player.setVelocityX(0);
        }

        if (this.cursors.up.isDown) {
            this.player.setVelocityY(-200);
        } else if (this.cursors.down.isDown) {
            this.player.setVelocityY(200);
        } else {
            this.player.setVelocityY(0);
        }
    }
}

// Configuração do jogo
const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    physics: {
        default: 'arcade',
        arcade: {
            debug: true,
        },
    },
    scene: GravityArrow,
};

// Inicializar o jogo
const game = new Phaser.Game(config);
</script>
</body>
</html>